---
title: 'Proposal for a Data Visualization: Gender Balance among Graduates of UGC-funded
  Programmes'
author: "Ava Cheung"
date: "3/27/2020"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# load packages:
library(tidyverse) # ggplot2, tidyr, ...

# load data, saved locally in same folder (for now)
graduates <- rio::import("Graduates2(Eng).csv") %>%
  mutate(Level = as_factor(`Level of Study`),
         Year = as_factor(`Academic Year`),
         Category = as_factor(`Broad Academic Programme Category` ),
         Gender = as_factor(Sex),
         Headcount = `Number of Graduates (Headcount)`
         ) %>% # rename and convert to factor
  select(Year, Gender, Level, Category, Headcount)

# source of data: https://data.gov.hk/en-data/dataset/hk-ugc-ugc-student-graduates2
# direct download link: http://www.ugcs.gov.hk/datagovhk/Graduates2(Eng).csv


# Define color palette:
# order: black, female, male, other, highlight
my_palette <- c("#383D3B", "#52DEE5", "#B3B3F1", "#FF220C", "#BEEF9E")
# my_palette <- c(
#   `black` = "#383D3B",
#   `male` = "#52DEE5", 
#   `female` = "#B3B3F1", 
#   `highlight` = "#FF220C",
#   `other` = "#BEEF9E")

```

```{r basic_stats, include=FALSE}

headcout_per_year <- graduates %>%
  group_by(Year) %>%
  summarise(Headcount = sum(Headcount))

```

## Research Question

Every year some 28'500 students graduate from programmes funded by the [University Grants Committee](https://www.ugc.edu.hk/eng/ugc/index.html) (UGC). Are male and female students equally represented among the graduates? Specifically, we will look at three dimensions:

* The evolution over time: how does the gender balance vary over the years?
* The differences between the categories: how does the gender balance vary by academic programme category?
* The differences between the study levels: how does the gender balance vary by level of study?

## Data Source and Background

The dataset can be downloaded from [data.gov.hk](https://data.gov.hk/en-data/dataset/hk-ugc-ugc-student-graduates2). Alternatively, the same data are also found on the UGC website in PDF format ([there](https://cdcf.ugc.edu.hk/cdcf/searchStatSiteReport.action)).     

UGC shares the number of graduates (Headcount) along with several variables:

* Sex (gender): _Male_, _Female_
* Level of Study: _Sub-degree, Undergraduate, Taught Postgraduate, Research Postgraduate_
* Broad Academic Programme Category: _Medicine, Dentistry and Health; Sciences; Engineering and Technology; Business and Management; Social Sciences; Arts and Humanities, Education_
* Academic Year: _YYYY/YY_, from 2009/10 to 2018/19

Since some UGC-funded programmes are mapped to more than one Academic Programme Category (APC), graduate numbers of these programmes are counted across the APCs concerned on a pro-rata basis. The decimal figures are rounded to the nearest whole number.   

‘Headcount’ refers to a simple count of numbers of graduates without taking into account the study mode (i.e. full-time or part-time study).  


```{r number_year, fig.height = 3.4, fig.width = 6.3, fig.align = "center", dpi = 300}

graduates %>%
  group_by(Year) %>%
  summarise(Headcount = sum(Headcount)) %>%
  ggplot(aes(x = Year, y = Headcount, group = 1)) +
  geom_line(color = my_palette[1], size=1.5) +
  geom_point(color = my_palette[1], size=2.5) +
  theme_minimal() + 
  labs(
    title = "Since 2015/16, the number of graduates of UGC-funded programmes\nhas stabilized around 28'500",
    # subtitle = "The number of graduates of UGC-funded programmes stabilized around 28'500 as from 2015/2016",
    caption = "Source: https://data.gov.hk/en-data/dataset/hk-ugc-ugc-student-graduates2", 
    x = "Academic Year", 
    y = "Number of Graduates (Headcount)"
       ) +
  theme(plot.caption = element_text(face = 'italic')) # + 
  # theme(
  #   text = element_text("Helvetica"), # ('Avenir Next Condensed'),
  #   strip.text = element_text(face = 'bold', hjust = 0),
  #   plot.caption = element_text(face = 'italic'),
  #   # panel.grid.major = element_line('white', size = 0.5),
  #   # panel.grid.minor = element_blank(),
  #   # panel.grid.major.y = element_blank(),
  #   # panel.ontop = TRUE
  # )

```

```{r stats_overall, include=FALSE}

graduates %>% 
  group_by(Gender) %>% 
  summarise(Headcount = sum(Headcount)) %>%
  mutate(percentage = Headcount/sum(Headcount))

# TODO: print a table instead.

```

Overall, 54.9% of the graduates were females.  


## Plan for Developing a Data Visualization Application

We propose to develop a data visualization application to explore the gender balance over time, by Academic Programme Category and by Level of Study. 

**Impact and Audience**  
The possibility to highlight gender imbalances among graduates of UGC-funded programmes will allow to:  

* inform decision-makers (UGS programme leads or other policymakers) on the potential existence of gender imbalances
* assess the performance of current or planned gender equality measures (as the data is updated every year) 
* inform the public and the politics on the existence of these imbalances

**Technology**  
The technology used should offer the possibility to display data visualizations and text (comments) side by side. This is needed for two reasons. First, because we want to tell a story with the data. Second, because we want to avoid the possibility that the readers misinterpret or overinterpret the data visualization(s). With some text, we can provide context, explanations, and interpretations.  

The data is not live and is updated annually. So, a visualization application will only need to be fed with a "static" data table, for instance, .csv format. We plan to use R to preprocess the data, typically to compute the percentage of male and female graduates by factor. We then foresee three tools that could be used for building the app:

1. We could stay with R and use an [R flexdashboard](https://rmarkdown.rstudio.com/flexdashboard/index.html) to display the plots. The storyboard schemes available is well suited to presenting a sequence of data visualizations and related commentary, and thus tell a data story.  

2. We could also use the [Tableau Public](https://public.tableau.com/en-us/s/), the free version of the Tableau software. There are no issues with data privacy, as the data used is open to the public.  

3. Alternatively, we could build one main interactive visualization using [D3.js](https://d3js.org/). The visualization could then be embedded in a small webpage explaining and commenting on the observations. However, it seems that the story that we want to tell, and can tell with this dataset, would benefit from multiple small and simple plots. We could still narrow the research question and limit the scope of what story we want to tell.  


## Plan to Tell a Story Behind Data

In addition to the main plots summarizing the gender balance by year, level of study and category, three main findings will be detailed, i.e. plotted and commented, in order to tell a story:  

1. The gender balance varies greatly by Academic Programme Category. Some categories are dominated by female graduates and others by men:  

```{r APC, fig.height = 2.5, fig.width = 6, fig.align = "center", dpi=300}

# TO DO: order by percentage female or male 

graduates %>% 
  group_by(Category, Gender) %>%
  summarise(Headcount = sum(Headcount)) %>%
  group_by(Category) %>%
  mutate(percentage = Headcount/sum(Headcount)) %>%
  ggplot(
  aes(x = Category, y = percentage, group = Gender)
  ) +
  geom_col(aes(fill = Gender), position = "fill") +
  theme_minimal() + 
  geom_abline(slope=0, intercept=0.5,  col = my_palette[1], lty = 2) +
  coord_flip() +
  labs(
    title = "The gender balance varies greatly by APC",
    # subtitle = "The number of graduates of UGC-funded programmes stabilized around 28'500 as from 2015/2016",
    caption = "Source: https://data.gov.hk/en-data/dataset/hk-ugc-ugc-student-graduates2", 
    x = "", 
    y = "Gender Balance"
       ) +
  scale_fill_manual(values = my_palette[2:3]) +
  scale_y_continuous(labels = scales::percent) +
  theme(plot.caption = element_text(face = 'italic'))

```

&nbsp;  
2. The gender imbalance in Engineering and Technology is increasing. Despite the overall growth of the number of graduates, the number of female graduates has remained stable. UGC and the higher education institutions could act to try reversing the trend:  

```{r year_category, fig.height = 3, fig.width = 8, fig.align = "center", dpi=300}

graduates %>% 
  filter(Category == "Engineering and Technology") %>%
  group_by(Year, Gender) %>%
  summarise(Headcount = sum(Headcount)) %>%
  ggplot(
  aes(x = Year, y = Headcount, group = Gender)
  ) +
  geom_line(aes(color = Gender), size = 2) +
  theme_minimal() +
  labs(
    title = "The gender imbalance is increasing in Engineering and Technology",
    subtitle = "The number of males graduates is increasing, whereas the number of females graduates is stable",
    caption = "Source: https://data.gov.hk/en-data/dataset/hk-ugc-ugc-student-graduates2", 
    x = "Academic Year", 
    y = "Number of Graduates"
       ) + 
  scale_color_manual(values = my_palette[2:3]) +
  theme(plot.caption = element_text(face = 'italic'))
    

```

&nbsp;  
3. A majority of the graduates are female for Sub-degree, Undergraduate and Taught Postgraduate levels, whereas the majority of graduates are males for the Research Postgraduate level. This finding is similar to what is observed in several other countries and might be an indication that there is a "leaky pipeline" effect (see for instance [European She Figures 2018](https://euraxess.ec.europa.eu/worldwide/japan/status-update-gender-equality-research-careers-europe-she-figures-2018)). UGC could work on attracting more males to lower levels of study and retaining more females at the highest level of study:   


```{r level_category,  fig.height = 2.4, fig.width = 6, fig.align = "center", dpi=300}

graduates %>% 
  group_by(Level, Gender) %>%
  summarise(Headcount = sum(Headcount)) %>%
  group_by(Level) %>%
  mutate(percentage = Headcount/sum(Headcount)) %>%
  ggplot(
  aes(x = Level, y = percentage, group = Gender)
  ) +
  geom_col(aes(fill = Gender), position = "stack") +
  geom_abline(slope = 0, intercept = 0.5,  col = my_palette[1], lty = 2) + 
  theme_minimal() +
  labs(
    title = "The Research Postgraduate level is the only level\nwhere female graduates are in minority",
    # subtitle = "Subtitle",
    caption = "Source: https://data.gov.hk/en-data/dataset/hk-ugc-ugc-student-graduates2", 
    x = "", 
    y = "Gender Balance"
       ) + 
  coord_flip() +
  scale_fill_manual(values = my_palette[2:3]) +
  scale_x_discrete(limits = rev(levels(graduates$Level))) +
  scale_y_continuous(labels = scales::percent) +
  theme(plot.caption = element_text(face = 'italic'))

```

This trend is found in most of the Academic Programme Categories, and detail by APC could also be plotted.   



